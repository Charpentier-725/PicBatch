# PicBatch 微信小程序 - 使用说明

## 一、下载并安装微信开发者工具

1. 访问: https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
2. 下载 Windows 稳定版
3. 安装到电脑

## 二、导入项目

### 方法一:直接导入构建产物(推荐测试使用)

1. 打开微信开发者工具
2. 点击 "+" 或 "导入项目"
3. 填写项目信息:
   - **项目目录**: 选择 `E:\CC\PicBatch\packages\miniprogram\dist`
   - **AppID**: 点击 "使用测试号" (无需注册)
   - **项目名称**: PicBatch 轻图
4. 点击"导入"按钮

### 方法二:开发模式(推荐开发使用)

1. 打开微信开发者工具
2. 点击 "+" 或 "导入项目"
3. 填写项目信息:
   - **项目目录**: 选择 `E:\CC\PicBatch\packages\miniprogram`
   - **AppID**: 点击 "使用测试号"
   - **项目名称**: PicBatch 轻图
4. 点击"导入"按钮
5. 在命令行中运行开发服务器:
   ```bash
   cd E:\CC\PicBatch\packages\miniprogram
   npm run dev:weapp
   ```

## 三、测试功能

### 1. 选择图片
- 点击 "选择图片" 按钮
- 选择 1-9 张图片
- 可以单独删除某张图片,或点击"清空"删除所有

### 2. 配置处理设置

**格式转换**:
- JPG (通用) - 最兼容
- PNG (透明) - 支持透明背景
- WebP (高压缩) - 文件最小

**质量调节**:
- 拖动滑块调整 10%-100%
- 推荐: 85% (质量与体积平衡)

**批量裁剪** (可选):
- 开启裁剪开关
- 选择裁剪比例:
  - 1:1 正方形 (适合头像、朋友圈)
  - 16:9 宽屏 (适合横屏视频封面)
  - 4:3 标准 (适合传统照片)
  - 3:2 照片 (适合打印)

**批量重命名** (可选):
- 开启重命名开关
- 输入文件前缀 (例如: "product")
- 文件会被重命名为: product_001.jpg, product_002.jpg...

### 3. 开始处理
- 点击 "开始处理" 按钮
- 等待处理完成(显示进度)
- 查看处理结果(成功数量、压缩率)

### 4. 保存图片
- 处理完成后会弹出提示询问是否保存
- 点击"保存"将图片保存到手机相册
- 首次使用需要授权相册访问权限

## 四、常见问题

### Q1: 无法选择图片?
A: 检查是否授权了相册访问权限。在模拟器中可能需要手动上传图片。

### Q2: 处理速度慢?
A:
- 图片数量越多,处理时间越长
- 高分辨率图片处理更慢
- 开启裁剪会增加处理时间
- 建议一次处理不超过 20 张图片

### Q3: 保存失败?
A:
- 检查相册权限是否授权
- 在模拟器中可能无法保存,请使用真机测试
- 确保手机存储空间充足

### Q4: 图片质量下降明显?
A:
- 调高质量滑块 (85%-95%)
- 选择 PNG 格式(无损)
- 避免重复压缩已经压缩过的图片

## 五、开发命令

```bash
# 安装依赖
npm install --registry=https://registry.npmmirror.com --legacy-peer-deps

# 开发模式 (文件监听,自动编译)
npm run dev:weapp

# 生产构建
npm run build:weapp

# 预览构建结果
在微信开发者工具中打开 dist 目录
```

## 六、项目结构

```
packages/miniprogram/
├── src/
│   ├── app.tsx              # 应用入口
│   ├── app.config.ts        # 应用配置
│   ├── pages/
│   │   └── index/           # 首页
│   │       ├── index.tsx    # 页面逻辑
│   │       ├── index.scss   # 页面样式
│   │       └── index.config.ts
│   ├── components/
│   │   └── SettingsPanel.tsx  # 设置面板组件
│   ├── lib/
│   │   └── imageProcessor.ts  # 图片处理核心逻辑
│   └── types/
│       └── index.ts         # TypeScript 类型定义
├── config/                  # Taro 配置文件
├── dist/                    # 编译输出目录
├── babel.config.js          # Babel 配置
├── tsconfig.json            # TypeScript 配置
└── package.json             # 依赖配置

```

## 七、技术栈

- **框架**: Taro 4.1.7 + React 18.3.1
- **语言**: TypeScript 5.6.3
- **样式**: Sass/SCSS
- **构建**: Webpack 5
- **图片处理**: Canvas API + Taro.createOffscreenCanvas

## 八、核心功能实现

### 图片处理流程:
1. 使用 `Taro.chooseImage()` 选择图片
2. 通过 `Taro.getImageInfo()` 获取图片尺寸
3. 使用 `Taro.createOffscreenCanvas()` 创建离屏画布
4. 在画布上绘制并裁剪图片
5. 通过 `Taro.canvasToTempFilePath()` 导出处理后的图片
6. 使用 `Taro.saveImageToPhotosAlbum()` 保存到相册

### 性能优化:
- 异步处理防止 UI 卡顿
- 实时进度反馈
- 批量操作支持
- 离屏渲染提升性能

## 九、下一步计划

### Version 1.3 计划功能:
- [ ] 历史记录 (IndexedDB 存储)
- [ ] 智能压缩 (自动选择最佳参数)
- [ ] 水印添加
- [ ] 批量旋转
- [ ] 图片拼接
- [ ] 在线预览对比

### Version 2.0 计划功能:
- [ ] AI 智能裁剪
- [ ] 背景移除
- [ ] 滤镜效果
- [ ] 云端 API 服务

## 十、联系方式

如有问题或建议,请提交 Issue 或 Pull Request。
