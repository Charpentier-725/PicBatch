# 更新日志

## [Version 1.1.2] - 2025-10-07

### ⚡ 性能优化

**状态**: 已完成 ✅
**更新日期**: 2025-10-07

#### ✅ Web 应用优化
- 🎯 **HEIC 库动态加载** - 移除 heic2any (1.35 MB) 从初始包
  - 之前: 初始加载 ~529 KB (gzipped)
  - 之后: 初始加载 **188 KB** (gzipped) ✨
  - **节省**: 64% 初始加载体积
  - heic2any 现在仅在处理 HEIC 文件时按需加载
- 📦 **优化打包策略** - 调整 Vite 配置 manualChunks
  - browser-image-compression: 动态加载 (53 KB gzipped)
  - heic2any: 动态加载 (341 KB gzipped)
  - 核心功能始终可用，重量级库按需加载

#### 📊 最终构建结果
**初始加载 (188 KB gzipped)**:
- CSS: 28.81 KB (5.73 KB gzipped)
- vendor-react: 11.92 KB (4.25 KB gzipped)
- vendor-ui: 106.58 KB (36.47 KB gzipped)
- vendor-zip: 99.71 KB (31.27 KB gzipped)
- index.js: 361.69 KB (110.70 KB gzipped)

**按需加载**:
- browser-image-compression: 53.17 KB (21.07 KB gzipped)
- heic2any: 1,352.62 KB (341.08 KB gzipped)

#### 📱 小程序优化
- ✅ **精简构建产物**: 351 KB 总包体积
  - taro.js: 127 KB (框架运行时)
  - app.js: 95 KB (应用代码)
  - vendors.js: 15 KB (第三方库)
  - 远低于 16 MB 小程序限制

#### 用户体验提升
- ⚡ **首次加载提速 64%** - 从 529 KB → 188 KB (gzipped)
- 📦 **更快的 TTI** (Time to Interactive)
- 🎯 **按需加载** - 仅加载用户需要的功能
- 📱 **移动端友好** - 更少的数据传输

---

## [Version 1.1.1] - 2025-10-07

### 🌐 PWA 离线支持

**状态**: 已完成 ✅
**更新日期**: 2025-10-07

#### ✅ 新增功能
- 🌐 **Service Worker** - 自动注册，后台运行
- 💾 **离线缓存** - 所有静态资源自动缓存（~2MB）
- ⚡ **离线访问** - 断网后仍可完整使用所有功能
- 🔄 **自动更新** - 后台检测新版本，自动下载更新
- 📱 **PWA 图标** - 6种尺寸图标自动生成
- 🎨 **Web App Manifest** - 完整的 PWA 配置

#### 技术实现
- **Vite PWA Plugin** v1.0.3
- **Workbox** - Service Worker 工具库
- **预缓存**: 23个文件（HTML/CSS/JS/图标）
- **缓存策略**: Google Fonts Cache First (1年)
- **轻量设计**: 无安装提示，纯网页体验

#### 用户体验
- ✅ 首次访问后自动缓存
- ✅ 离线模式下全功能可用
- ✅ 加载速度提升（从缓存读取）
- ✅ 无需安装，打开即用

**文档**: 详见 [PWA_OFFLINE_SUPPORT.md](PWA_OFFLINE_SUPPORT.md)

---

## [Version 1.2] - 开发中 🚧

### 📱 微信小程序版本

**状态**: 核心功能已完成，进入真机测试阶段 (75% 完成)
**预计发布**: Q1 2026
**更新日期**: 2025-10-07

#### ✅ 已完成 (Updated 2025-10-07 16:30)
- 🏗️ **Monorepo 架构** - packages/shared + packages/miniprogram 结构
- 📦 **共享代码包** - 提取平台无关的核心算法
  - 裁剪算法 (`calculateCropArea`)
  - 重命名逻辑 (`generateNewFilename`)
  - 压缩算法 (`compress-core.ts`)
  - 类型定义 (`types.ts`)
- 📱 **Taro 项目骨架** - 配置文件和基础结构
- 🎨 **UI 实现** - 主页面、设置面板、图片列表
- 🖼️ **图片处理核心** - Canvas API + 格式转换
  - 格式转换 (JPG/PNG/WebP)
  - 质量压缩（0-100%）
  - 批量裁剪（5种比例）
  - 批量重命名（前缀 + 序号）
- 💾 **保存到相册** - 含权限管理和授权流程
- 📊 **进度显示** - 实时处理进度和批量操作进度
- ✅ **构建成功** - dist 输出正常（~300KB）
- 📚 **完整文档** + 使用说明
  - [技术方案](docs/version-1.2-plan.md) (582 行)
  - [实施指南](docs/version-1.2-implementation-guide.md) (400+ 行)
  - [使用说明](packages/miniprogram/使用说明.md) (186 行)
- 🎯 **TypeScript 配置** - Babel + TSConfig 完善
- ✅ **微信开发者工具测试** - 界面正常显示
- ✅ **核心代码文件** - imageProcessor.ts (279行)
  - processImage - 单图处理
  - processImages - 批量处理
  - saveToAlbum - 相册保存（含权限流程）
  - saveImagesToAlbum - 批量保存

#### 🚧 进行中
- ⏳ 真机测试与性能优化
- ⏳ 提交微信审核

#### 📅 待开发
- [ ] 存储与分享
  - [ ] 本地历史记录 (Taro Storage)
  - [ ] 微信分享功能
- [ ] UI 优化
  - [ ] 深色模式支持
  - [ ] 动画效果
  - [ ] 错误提示优化
- [ ] 性能优化
  - [ ] 分包加载
  - [ ] 图片懒加载
  - [ ] 大文件处理优化
- [ ] 测试与发布
  - [ ] 真机测试 (Android/iOS)
  - [ ] 性能测试
  - [ ] 微信审核提交

**技术栈**: Taro 4.1.7 + React 18.3 + TypeScript 5.6 + Sass
**测试环境**: 微信开发者工具 Stable 1.06.2504030
**预览截图**: 已在开发者工具中正常运行 ✅

---

## [Version 1.1] - 2025-10-07

### 🎉 重大更新

Version 1.1 新增了**批量裁剪**、**批量重命名**、**智能压缩**和**历史记录**四大核心功能！

### 新增功能

#### 批量裁剪 ✨
- ✨ **预设比例** - 1:1（正方形）、16:9（宽屏）、4:3（标准）、3:2（照片）
- ✨ **自定义比例** - 支持输入任意宽高比（如 21:9）
- ✨ **裁剪位置** - 居中、左上、右上、左下、右下5种位置可选
- ✨ **智能计算** - 自动计算最佳裁剪区域，保留图片重要内容
- ✨ **无损质量** - 裁剪过程保持原始图片质量

#### 批量重命名 ✨
- ✨ **前缀/后缀** - 支持自定义文本前缀和后缀
- ✨ **保留原名** - 可选保留原文件名
- ✨ **序号编号** - 1位/2位/3位序号可选（如 1、01、001）
- ✨ **起始序号** - 自定义起始序号（如从 100 开始）
- ✨ **实时预览** - 显示3个文件名示例
- ✨ **智能验证** - 自动检测非法字符和文件名长度

#### 智能压缩 🧠
- 🧠 **图片类型识别** - 自动识别照片/图标/透明图/图形
- 🧠 **策略优化** - 根据类型自动选择最佳压缩策略
  - 照片：JPEG 85%质量
  - 图标：PNG 无损
  - 透明图：PNG 90%质量
  - 图形：WebP 80%质量
- 🧠 **迭代压缩** - 8次迭代逼近目标大小，误差<5%
- 🧠 **透明检测** - 自动检测透明通道，保留PNG格式

#### 历史记录 📚
- 📚 **自动保存** - 每次处理自动保存参数记录
- 📚 **快速恢复** - 一键恢复历史处理参数
- 📚 **详细信息** - 显示时间、文件数、压缩率等
- 📚 **智能清理** - 自动保留最新50条记录
- 📚 **统计功能** - 查看总处理文件数和节省空间
- 📚 **IndexedDB** - 本地存储，隐私安全

### UI 改进
- 🎨 **Tabs 组织** - 处理设置分为"基础/裁剪/重命名"三个选项卡
- 🎨 **历史按钮** - Header 添加历史记录按钮，便捷访问
- 🎨 **图标优化** - 各功能配以清晰图标（Settings/Crop/FileText/History）
- 🎨 **响应式** - 移动端完美适配，标签显示优化

## [MVP 1.0 + 格式扩展] - 2025-10-07

### 新增功能

#### 格式扩展
- ✨ **SVG 支持** - 支持上传 SVG 矢量图，自动栅格化为 PNG
- ✨ **GIF 支持** - 支持上传 GIF 动画，提取第一帧为静态图片
- ✨ **扩展名大小写选择** - 可选择输出 `.jpg` 或 `.JPG`、`.png` 或 `.PNG` 等（共8种选项）
- ✨ **输出格式分组** - 格式选择器按类型分组显示（JPEG/PNG/WebP/GIF）

#### 移动端优化
- 📱 **文件名完整显示** - 移动端文件名不再截断，使用 `break-all` 完整显示
- 📱 **滚动支持** - 文件列表添加滚动容器（最高 60vh），超出可滚动查看
- 📱 **触摸优化** - 所有按钮触摸区域 ≥44px，符合移动端设计规范
- 📱 **响应式字体** - 标题、正文字体根据屏幕尺寸自适应调整
- 📱 **自适应间距** - 移动端间距更紧凑，桌面端间距更宽松

#### 性能优化
- ⚡ **代码分割** - 将代码拆分为 6 个独立 chunk，按需加载
  - vendor-react (11.92 kB)
  - vendor-ui (101.11 kB)
  - vendor-zip (99.71 kB)
  - vendor-image (1406.10 kB)
- ⚡ **构建优化** - 总大小 ~1.9MB，gzip 压缩后仅 535KB
- 🛡️ **错误边界** - 添加全局错误捕获组件，提升应用稳定性
- 🔍 **SEO 优化** - 完整的元数据和 Open Graph 标签

### 修复问题
- 🐛 修复移动端文件名被截断的问题
- 🐛 修复移动端文件列表无法滚动的问题
- 🐛 修复移动端按钮触摸区域过小的问题

### 技术改进
- 📝 更新类型定义：`OutputFormat` 扩展为 8 种选项
- 🔧 新增函数：`convertSVG()` - SVG 转 PNG
- 🔧 新增函数：`convertGIF()` - GIF 提取首帧
- 🔧 优化函数：`getOutputFilename()` - 支持扩展名大小写映射
- 🔧 扩展验证：`validateFile()` - 支持 SVG/GIF MIME 类型

### 代码变更统计
```
修改文件: 9 个
新增文件: 2 个 (ErrorBoundary.tsx, CHANGELOG.md)
新增代码: ~150 行
优化代码: ~50 行
```

---

## [MVP 1.0] - 2025-10-06

### 核心功能
- ✅ 文件上传（拖拽、点击、批量）
- ✅ 格式转换（JPG/PNG/WebP/HEIC）
- ✅ 质量压缩（滑块调节 1-100%）
- ✅ 大小压缩（目标 KB）
- ✅ 批量处理（实时进度显示）
- ✅ ZIP 打包下载
- ✅ 状态管理（待处理/处理中/成功/失败）

### 技术栈
- React 19.0
- TypeScript 5.6
- Vite 7.1
- Tailwind CSS 3.4
- Zustand 4.5
- shadcn/ui 3.2+

---

## 路线图

### Version 1.1（计划中）
- [ ] 批量裁剪（1:1、16:9、4:3、自定义）
- [ ] 批量重命名（前缀 + 序号）
- [ ] 按目标大小压缩优化
- [ ] Google AdSense 接入

### Version 1.2（计划中）
- [ ] 微信小程序版本
- [ ] 智能裁剪功能

### Version 2.0（计划中）
- [ ] API 服务
- [ ] 高级批量处理功能
